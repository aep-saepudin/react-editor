<!DOCTYPE html>
<html lang="en">
<head>

	<!-- SITE TITTLE -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Web Builder Template</title>

	<!-- PLUGINS CSS STYLE -->
	<link href="plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet">
	<link href="plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="plugins/selectbox/select_option1.css" rel="stylesheet">
	<link href="plugins/slick/slick.css" rel="stylesheet" media="screen">
	<link href="plugins/slick/slick-theme.css" rel="stylesheet" media="screen">
	<link href="plugins/prismjs/prism.css" rel="stylesheet">
	<link rel="stylesheet" href="plugins/fancybox/jquery.fancybox.min.css" />
	<link href="plugins/selectbox/select_option1.css" rel="stylesheet">
	<link href="plugins/thin-line-icons/css/thin-line-icons.css" rel="stylesheet">
	<link href="plugins/isotope/isotope.min.css" rel="stylesheet">
	<link href="plugins/animate.css" rel="stylesheet">
	<link href="plugins/datepicker/datepicker.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css">

	<!-- GOOGLE FONT -->

	<!-- CUSTOM CSS -->
	<link href="css/style.css" rel="stylesheet">


	<!-- FAVICON -->
	<link href="img/favicon.png" rel="shortcut icon">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

</head>

<body id="body" class="page-contactus boxed-menu">
	<div class="mobile-sticky-header-overlay"></div>
	<!-- TOPBAR -->
	<!-- <div class="topbar">
		<div class="container">
			<div class="row">
				<div class="col-sm-9">
					<div class="topbar-content">
						<i class="fa fa-phone" aria-hidden="true"></i>
						<a href="tel:+62 22 20525693">+62 22 20525693</a>
					</div>
					<div class="topbar-content">
						<i class="fa fa-envelope" aria-hidden="true"></i>
						<a href="mailto:info@example.com ">info@example.com</a>
					</div>
					<div class="topbar-content">
						<i class="fa fa-map-marker" aria-hidden="true"></i>
						<p>Bandung, Indonesia</p>
					</div>
				</div>
			</div>
		</div>
	</div> --><!-- TOPBAR ENDS-->
	<!-- HEADER -->
	<!--header id="pageTop" class="header"-->
	<!-- NAVBAR -->
	<header>
		<div class="navbar navbar-toggleable-sm main-nav bg-dark-navy" style="max-width: 100%">
			<nav class="container qw-section" id="nav-container">
				<button class="navbar-toggler navbar-toggler-right">
					<span class="burger-menu icon-toggle"><i class="fa fa-bars"></i></span>
				</button>
				<a class="navbar-brand" href="index.html"><img src="img/logo.png" alt="logo"></a>

				<div class="navbar-collapse">
					<ul class="navbar-nav ml-auto qw-list-item">
						<li class="nav-item">
							<a class="nav-link" href="index.html"><span class="sr-only">(current)</span>Home</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="profile.html"><span class="sr-only"></span>Profile</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="contact.html"><span class="sr-only"></span>Contact</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="product.html"><span class="sr-only"></span>Product</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="gallery.html"><span class="sr-only"></span>Gallery</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="bonus.html"><span class="sr-only"></span>Bonus</a>
						</li>
						<li class="nav-item qw-list-default">
							<a class="nav-link" href="gallery.html"><span class="sr-only"></span>Default</a>
						</li>
						<li class="nav-item dropdown drop_single ">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" href="javascript:void(0)" data-account>Account <b class="caret"></b></a>
							<ul class="dropdown-menu dd_first">
								<li><a href="sign-up.html">Sign Up</a></li>
								<li><a href="login.html">Login</a></li>
							</ul>
						</li>
						<li class="nav-item dropdown drop_single ">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" href="javascript:void(0)" data-login>My Account</a>
							<ul class="dropdown-menu dd_first">
								<li><a href="account.html">My Account</a></li>
								<li><a href="change-pass.html">Change Password</a></li>
								<li><a href="address-book.html">Address Book</a></li>
								<li><a href="view-cart.html">List Cart</a></li>
								<li><a href="whistlist.html">Whist List</a></li>
								<li><a href="order-history.html">Order History</a></li>
								<li><a href="rewards-point.html">Rewards Points</a></li>
								<li><a href="transactions.html">Transaction</a></li>
								<li><a href="logout.php">Logout</a></li>
							</ul>
						</li>
						<!-- header search -->
						<li class="nav-item">
							<a href="#" class="btn-search nav-link"><i class="fa fa-search"></i></a>
							<form  class="search_form">
								<input type="text" name="search" placeholder="Search anything..">
								<button class="btn btn-primary btn-small" type="submit">Search</button>
							</form>
						</li>
					</ul>
				</div>
				<!-- header search ends-->
			</nav><!-- NAVBAR ENDS-->
		</div>
	</header>
	<!--/header-->

<div class="main-wrapper pages">
	<!-- BREDCRUMB -->
	<section class="bredcrumb" id="bredcrumb">
		<div class="bg-image text-center" style="background-image: url('img/1920x500.jpg');">
			<h1>Order History</h1>
			<ul>
				<li>Home</li>
				<li><a href="javascript:void(0)">Order History</a></li>
			</ul>
		</div>
	</section>

	<!-- CONTACT US -->
	<section class="contactus" id="contactus" style="margin-bottom: 50px">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!-- Contact Form Starts-->
						<!-- section title -->
						<div class="sectionTitle">
							<h2>Order History</h2>
						</div>
						<!-- section title ends -->
						<!-- Blog Post Row -->
				</div>
			</div>

			<div id="detail_order">
	            <table id="table" class="display" cellspacing="0" width="100%">
	                <thead>
	                    <tr>
	                        <th>Order ID</th>
	                        <th>First Name</th>
	                        <th>Last Name</th>
	                        <th>Status</th>
	                        <th>Start date</th>
	                        <th>Total</th>
	                        <th>Action</th>
	                    </tr>
	                </thead>
	                <tfoot>
	                    <tr>
	                        <th>Order ID</th>
	                        <th>First Name</th>
	                        <th>Last Name</th>
	                        <th>Status</th>
	                        <th>Start date</th>
	                        <th>Total</th>
	                        <th>Action</th>
	                    </tr>
	                </tfoot>
	            </table>
	        </div>
	        <!-- /.row -->
	        <br>
		</div>
	</section>

	<!-- FOOTER -->
	<footer class="footer footer-classic bg-dark">
		<div class="container">
			<div class="row">
				<div class="col-md-3">
					<div class="footer-text">
						<a href="#"><img class="footer-logo" src="img/logo.png" alt="footer logo"></a>
						<p>
							Lorem ipsum dolor sit amet consectetur adipisicing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua ut enim ad minim veniam quis nostrud exercitation.
						</p>
						<div class="social-icons">
							<a href="#" class="btn btn-social btn-social-o twitter">
								<i class="fa fa-twitter"></i>
							</a>
							<a href="#" class="btn btn-social btn-social-o linkedin">
								<i class="fa fa-linkedin"></i>
							</a>
							<a href="#" class="btn btn-social btn-social-o facebook">
								<i class="fa fa-facebook-f"></i>
							</a>
							<a href="#" class="btn btn-social btn-social-o skype">
								<i class="fa fa-skype"></i>
							</a>
							<a href="#" class="btn btn-social btn-social-o pinterest">
								<i class="fa fa-pinterest-p"></i>
							</a>
						</div>
					</div>
				</div>
				<div class="col-xl-2 col-md-2">
					<div class="links">
						<h3>Links</h3>
						<ul class="">
							<li><a href="#">Home</a></li>
							<li><a href="#">Profile</a></li>
							<li><a href="#">Contact</a></li>
							<li><a href="#">Product</a></li>
							<li><a href="#">Gallery</a></li>
						</ul>
					</div>
				</div>
				<div class="col-md-3">
					<div class="location">
						<h3>Location</h3>
						<ul>
							<li>Excepteur sint occaecat cupidat non proident sunt.</li>
							<li><i class="fa fa-home"></i> Jl. Coblong Timur,</li>
							<li><i class="fa fa-phone"></i> <a href="tel:+62 22 20525693">+62 22 20525693</a></li>
							<li><i class="fa fa-envelope"></i> <a href="mailto.html"> info@example.com </a></li>
						</ul>
					</div>
				</div>
				<div class="col-md-4">
					<div class="instagram">
						<h3>Gallery</h3>
						<ul class="row instagram-image qw-list-item">
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-1.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-2.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-3.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-4.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-5.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-6.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4 qw-list-default"><a href="#"><img src="img/gallery/image-7.jpg" alt="insta"></a></li>
						</ul>
					</div>
				</div>

				<!-- COPY RIGHT -->
			</div>
			<div class="copyright">
				<hr>
				<div class="row">
					<div class="col-sm-6 offset-sm-3">
						<div class="copyRight_text text-center">
							<p> &copy; 2017 Copyright Web Builder.</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</footer>
</div>


<!-- JAVASCRIPTS -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbo8AqPhlblo2nbndho2I8zLzr0o9Qs28"></script>
<script src="plugins/jquery/jquery.min.js"></script>
<script src="plugins/jquery/jquery-migrate-3.0.0.min.js"></script>
<script src="plugins/bootstrap/js/tether.min.js"></script>
<script src="plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="plugins/selectbox/jquery.selectbox-0.1.3.min.js"></script>
<script src="plugins/slick/slick.min.js"></script>
<script src="js/Chart.min.js"></script>
<script src="plugins/circle-progress/jquery.appear.js"></script>
<script src="plugins/isotope/isotope.min.js"></script>
<script src="plugins/fancybox/jquery.fancybox.min.js"></script>
<script src="js/waypoints.min.js"></script>
<script src="plugins/counterUp/jquery.counterup.js"></script>
<script src="plugins/smoothscroll/SmoothScroll.js"></script>
<script src="plugins/velocity/velocity.min.js"></script>
<script src="plugins/datepicker/bootstrap-datepicker.min.js"></script>
<script src="plugins/syotimer/jquery.syotimer.min.js"></script>
<script src="js/custom.js"></script>
<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

	<script>
        $(function () {
            loadPage()
        })

        async function loadPage(){
            await getOrdersHistory()
        }

        function getClientServiceID() {
          return $.post('scid.txt')
            .then(res => {
              return JSON.parse(res)
            })
        }

        function getCustomer() {
          return $.post('getdata.php').then(function (customer_id) {
            return customer_id
          })
        }

        async function getCustomerById() {
          let scid = await getClientServiceID()
              customer_id = await getCustomer()
          return $.post('https://build.web.id/api/customers/getCustomerdatabyId/', {
              client_id: scid.cid,
              service_id: scid.layanan_id,
              customer_id: customer_id
            }).then(res => res.data)
        }

        async function getOrdersHistory() {
          let scid = await getClientServiceID()
              customer_id = await getCustomer()
              customers = await getCustomerById()
          if(customer_id){
            firstname = customers.firstname;
            lastname = customers.lastname;
            $('[data-login]').html(firstname+' <b class="caret"></b>')
            $('[data-account]').hide()

            return $.post('https://build.web.id/api/customers/getOrdersHistory/', {
              client_id: scid.cid,
              service_id: scid.layanan_id,
              customer_id: customer_id
            },function(data){
                var row = data.data;
                $('#table').DataTable( {
                    "data" : row,
                    columns : [
                        { "data" : 'order_id' },
                        { "data" : 'firstname' },
                        { "data" : 'lastname' },
                        { "data" : 'status' },
                        { "data" : 'date_added' },
                        {
                            data: 'total',
                            render: $.fn.dataTable.render.number( ',', '.', 0, 'Rp ' )
                        },
                        {
                            "data": 'order_id',
                            "render": function(data, type, row, meta){
                                data = '<button onClick="getDetail('+data+')" style="padding:3px"><i class="fa fa-search"></i> Detail </button><button onClick="getInvoice('+data+')" style="padding:3px"><i class="fa fa-list-alt"></i> Invoice</button>';
                                return data;
                            }
                        }
                    ]
                });
            });
          }else{
            $('[data-login]').hide()
            $('[data-account]').show()

            swal("Anda belum login!", "Silahkan login terlebih dahulu!", "info")
            .then((value) => {
                window.location.href = "login.html";
            });
          }
          
        }

        async function getOrderById(order_id) {
          let scid = await getClientServiceID()
              customer_id = await getCustomer()
          return $.post("https://build.web.id/api/customers/getOrderDetail/",{
                "client_id": scid.cid,
                "service_id": scid.layanan_id,
                "customer_id": customer_id,
                "order_id": order_id
            }).then(res => res.data)
        }

        async function getOrderProductbyOrderId(order_id) {
          let scid = await getClientServiceID()
              customer_id = await getCustomer()
          return $.post("https://build.web.id/api/customers/getOrderProductbyOrderId/",{
                "client_id": scid.cid,
                "service_id": scid.layanan_id,
                "order_id": order_id
            }).then(res => res.data)
        }

        async function getCityName(province,city) {
          let scid = await getClientServiceID()
          return $.post("https://build.web.id/api/customers/getCityName/",{
                "client_id": scid.cid,
                "service_id": scid.layanan_id,
                "province": province,
                "city": city
            }).then(res => res.data)
        }

        async function getDetail(order_id) {
        	let orders = await getOrderById(order_id)
                product = await getOrderProductbyOrderId(order_id)
                len = product.length;
                sub_total = parseInt(orders.total).toFixed(0);
                shipping_method = orders.shipping_method;
                payment = await getCityName(orders.payment_zone_id,orders.payment_city)
                shipping = await getCityName(orders.shipping_zone_id,orders.shipping_city)
            	customer_id = await getCustomer()

            if(customer_id){
                var htmlData = '';
                console.log(orders)
                htmlData += '<table class="display blueTable" width="100%"><thead>';
                htmlData += '<tr><th colspan=2>Order Details</th></tr></thead>';
                htmlData += '<tbody><tr><td>Order ID : #'+orders.order_id+'</td><td>Payment Method : '+orders.payment_method+'</td></tr>';
                htmlData += '<tr><td>Date Added : '+orders.date_added+'</td><td>Shipping Method : '+orders.shipping_method+'</td></tr></body>';
                htmlData += '</table>';
                htmlData += '<br><br>';
                htmlData += '<table class="display blueTable" border=1 width="100%"><thead>';
                htmlData += '<tr><th>Payment Address</th><th>Shipping Address</th></tr></thead>';
                htmlData += '<tbody><tr><td>Name : '+orders.payment_firstname+' '+orders.payment_lastname+'</td><td>Name : '+orders.shipping_firstname+' '+orders.shipping_lastname+'</td></tr>';
                htmlData += '<tr><td>Address : '+orders.payment_address_1+'</td><td>Address : '+orders.shipping_address_1+'</td></tr>';
                htmlData += '<tr><td>City : '+payment.type+' '+payment.city_name+' '+orders.payment_postcode+'</td><td>City : '+shipping.type+' '+shipping.city_name+' '+orders.shipping_postcode+'</td></tr>';
                htmlData += '<tr><td>Prov : '+payment.province+'</td><td>Prov : '+shipping.province+'</td></tr></body>';
                htmlData += '<tr><td>Country : '+orders.payment_country+'</td><td>Country : '+orders.shipping_country+'</td></tr>';
                htmlData += '</body></table>';
                htmlData += '<br><br>';

                htmlData += '<table class="display-product blueTable" border=1 width="100%"><thead>';
                htmlData += '<tr><th>No</th><th>Product Name</th><th>Model</th><th>Quantity</th><th>Price</th><th>Total</th></tr></thead><tbody>';
                var jumlah_total = [];
                for (var i = 0; i < len; i++) {
                    var price = parseInt(product[i].price).toFixed(2);
                    var total = parseInt(product[i].total).toFixed(2);
                    jumlah_total.push(parseInt(total));
                    
                    price = price.replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                    total = total.replace(/(\d)(?=(\d{3})+\.)/g, '$1,');

                    htmlData += '<tr><td style="text-align:center">'+(i+1)+'</td><td>'+product[i].name+'</td><td>'+product[i].model+'</td><td style="text-align:right">'+product[i].quantity+'</td><td style="text-align:right">Rp '+price+'</td><td style="text-align:right">Rp '+total+'</td></tr>';
                }
                var sum_total = jumlah_total.reduce((a, b) => a + b, 0);
                sum_total = sum_total.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');

                htmlData += '<tr><td colspan=5 style="text-align:right"><b>Sub Total</b></td><td style="text-align:right">Rp '+sum_total+'</td></tr>';
                htmlData += '<tr><td colspan=5 style="text-align:right"><b>'+shipping_method+'</b></td><td style="text-align:right">Rp 0.00</td></tr>';
                htmlData += '<tr><td colspan=5 style="text-align:right"><b>Total</b></td><td style="text-align:right">Rp '+sum_total+'</td></tr>';
                htmlData += '<tbody></table>';

                htmlData += '<br><br>';
                htmlData += '<table class="display blueTable" border=1 width="100%"><thead>';
                htmlData += '<tr><th colspan=2>Order Comments</th></tr></thead>';
                htmlData += '<tbody><tr><td>'+orders.comment+'</td></tr></body>';
                htmlData += '</table>';
                htmlData += '<br><br>';
                /*htmlData += '<table class="display blueTable" border=1 width="100%"><thead>';
                htmlData += '<tr><th>Date Added</th><th>Status</th></tr></thead>';
                htmlData += '<tbody><tr><td>Order Status</td><td>Order Date</td></tr></body>';
                htmlData += '</table>';*/

                htmlData += '<br>';
                htmlData += '<div style="float:right"><a href="order-history.html"><button class="btn btn-primary right">Back</button></a></div>';
                htmlData += '<br>';
                
                $("#detail_order").html(htmlData);
            }else{
                swal("Anda belum login!", "Silahkan login terlebih dahulu!", "info")
                .then((value) => {
                    window.location.href = "login.html";
                });
            }
        }

        async function getInvoice(order_id){
            $('[data-title]').text('Invoice')
            let orders = await getOrderById(order_id)
                product = await getOrderProductbyOrderId(order_id)
                len = product.length;
                sub_total = parseInt(orders.total).toFixed(0);
                shipping_method = orders.shipping_method;
                payment = await getCityName(orders.payment_zone_id,orders.payment_city)
                shipping = await getCityName(orders.shipping_zone_id,orders.shipping_city)
                customer_id = await getCustomer()
            if(customer_id){
                var htmlData = '';

                htmlData += '<table class="display blueTable" border=1 width="100%"><thead>';
                htmlData += '<tr><th colspan=2>Order Details</th></tr></thead>';
                htmlData += '<tbody><tr><td>No Invoice : '+orders.invoice_prefix+orders.invoice_no+'</td><td>Currency : '+orders.currency_code+'</td></tr></body>';
                htmlData += '<tr><td>Order ID : #'+orders.order_id+'</td><td>Payment Method : '+orders.payment_method+'</td></tr>';
                htmlData += '<tr><td>Date Added : '+orders.date_added+'</td><td>Shipping Method : '+orders.shipping_method+'</td></tr></body>';
                htmlData += '</table>';
                htmlData += '<br><br>';

                htmlData += '<table class="display-product blueTable" border=1 width="100%"><thead>';
                htmlData += '<tr><th>No</th><th>Product Name</th><th>Model</th><th>Quantity</th><th>Price</th><th>Total</th></tr></thead><tbody>';
                var jumlah_total = [];
                for (var i = 0; i < len; i++) {
                    var price = parseInt(product[i].price).toFixed(2);
                    var total = parseInt(product[i].total).toFixed(2);
                    jumlah_total.push(parseInt(total));
                    
                    price = price.replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                    total = total.replace(/(\d)(?=(\d{3})+\.)/g, '$1,');

                    htmlData += '<tr><td style="text-align:center">'+(i+1)+'</td><td>'+product[i].name+'</td><td>'+product[i].model+'</td><td style="text-align:right">'+product[i].quantity+'</td><td style="text-align:right">Rp '+price+'</td><td style="text-align:right">Rp '+total+'</td></tr>';
                }
                var sum_total = jumlah_total.reduce((a, b) => a + b, 0);
                sum_total = sum_total.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');

                htmlData += '<tr><td colspan=5 style="text-align:right"><b>Sub Total</b></td><td style="text-align:right">Rp '+sum_total+'</td></tr>';
                htmlData += '<tr><td colspan=5 style="text-align:right"><b>'+shipping_method+'</b></td><td style="text-align:right">Rp 0.00</td></tr>';
                htmlData += '<tr><td colspan=5 style="text-align:right"><b>Total</b></td><td style="text-align:right">Rp '+sum_total+'</td></tr>';
                htmlData += '<tbody></table>';

                htmlData += '<br><br>';
                htmlData += '<table class="display blueTable" border=1 width="100%"><thead>';
                htmlData += '<tr><th colspan=2>Shipping Address</th></tr></thead>';
                htmlData += '<tbody><tr><td>Name : '+orders.payment_firstname+' '+orders.payment_lastname+'</td><td>Telepon : '+orders.telephone+'</td></tr>';
                htmlData += '<tr><td>Address : '+orders.shipping_address_1+'</td><td>City : '+shipping.city_name+'</td></tr></body>';
                htmlData += '<tr><td>Prov : '+shipping.province+'</td><td>Country : '+orders.shipping_country+'</td></tr></body>';
                htmlData += '</table>';
                
                htmlData += '<br>';
                htmlData += '<div style="float:right"><a href="order-history.html"><button class="btn btn-primary right">Back</button></a></div>';
                htmlData += '<br>';
                
                $("#detail_order").html(htmlData);
            }else{
                swal("Anda belum login!", "Silahkan login terlebih dahulu!", "info")
                .then((value) => {
                    window.location.href = "login.html";
                });
            }
        }
    </script>
    
</body>

</html>