<!DOCTYPE html>
<html lang="en">
<head>

	<!-- SITE TITTLE -->
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Web Builder Template</title>

	<!-- PLUGINS CSS STYLE -->
	<link href="plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet">
	<link href="plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="plugins/selectbox/select_option1.css" rel="stylesheet">
	<link href="plugins/slick/slick.css" rel="stylesheet" media="screen">
	<link href="plugins/slick/slick-theme.css" rel="stylesheet" media="screen">
	<link href="plugins/prismjs/prism.css" rel="stylesheet">
	<link rel="stylesheet" href="plugins/fancybox/jquery.fancybox.min.css" />
	<link href="plugins/selectbox/select_option1.css" rel="stylesheet">
	<link href="plugins/thin-line-icons/css/thin-line-icons.css" rel="stylesheet">
	<link href="plugins/isotope/isotope.min.css" rel="stylesheet">
	<link href="plugins/animate.css" rel="stylesheet">
	<link href="plugins/datepicker/datepicker.min.css" rel="stylesheet">


	<!-- GOOGLE FONT -->

	<!-- CUSTOM CSS -->
	<link href="css/style.css" rel="stylesheet">


	<!-- FAVICON -->
	<link href="img/favicon.png" rel="shortcut icon">

	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

</head>

<body id="body" class="page-contactus boxed-menu">
	<div class="mobile-sticky-header-overlay"></div>
	<!-- TOPBAR -->
	<!-- <div class="topbar">
		<div class="container">
			<div class="row">
				<div class="col-sm-9">
					<div class="topbar-content">
						<i class="fa fa-phone" aria-hidden="true"></i>
						<a href="tel:+62 22 20525693">+62 22 20525693</a>
					</div>
					<div class="topbar-content">
						<i class="fa fa-envelope" aria-hidden="true"></i>
						<a href="mailto:info@example.com ">info@example.com</a>
					</div>
					<div class="topbar-content">
						<i class="fa fa-map-marker" aria-hidden="true"></i>
						<p>Bandung, Indonesia</p>
					</div>
				</div>
			</div>
		</div>
	</div> --><!-- TOPBAR ENDS-->
	<!-- HEADER -->
	<!--header id="pageTop" class="header"-->
	<!-- NAVBAR -->
	<header>
		<div class="navbar navbar-toggleable-sm main-nav bg-dark-navy" style="max-width: 100%">
			<nav class="container qw-section" id="nav-container">
				<button class="navbar-toggler navbar-toggler-right">
					<span class="burger-menu icon-toggle"><i class="fa fa-bars"></i></span>
				</button>
				<a class="navbar-brand" href="index.html"><img src="img/logo.png" alt="logo"></a>

				<div class="navbar-collapse">
					<ul class="navbar-nav ml-auto qw-list-item">
						<li class="nav-item">
							<a class="nav-link" href="index.html"><span class="sr-only">(current)</span>Home</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="profile.html"><span class="sr-only"></span>Profile</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="contact.html"><span class="sr-only"></span>Contact</a>
						</li>
						<li class="nav-item active">
							<a class="nav-link" href="product.html"><span class="sr-only"></span>Product</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="gallery.html"><span class="sr-only"></span>Gallery</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="bonus.html"><span class="sr-only"></span>Bonus</a>
						</li>
						<li class="nav-item qw-list-default">
							<a class="nav-link" href="gallery.html"><span class="sr-only"></span>Default</a>
						</li>
						<li class="nav-item dropdown drop_single ">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" href="javascript:void(0)" data-account>Account <b class="caret"></b></a>
							<ul class="dropdown-menu dd_first">
								<li><a href="sign-up.html">Sign Up</a></li>
								<li><a href="login.html">Login</a></li>
							</ul>
						</li>
						<li class="nav-item dropdown drop_single ">
							<a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" href="javascript:void(0)" data-login>My Account</a>
							<ul class="dropdown-menu dd_first">
								<li><a href="account.html">My Account</a></li>
								<li><a href="change-pass.html">Change Password</a></li>
								<li><a href="address-book.html">Address Book</a></li>
								<li><a href="view-cart.html">List Cart</a></li>
								<li><a href="whistlist.html">Whist List</a></li>
								<li><a href="order-history.html">Order History</a></li>
								<li><a href="rewards-point.html">Rewards Points</a></li>
								<li><a href="transactions.html">Transaction</a></li>
								<li><a href="logout.php">Logout</a></li>
							</ul>
						</li>
						<!-- header search -->
						<li class="nav-item">
							<a href="#" class="btn-search nav-link"><i class="fa fa-search"></i></a>
							<form  class="search_form">
								<input type="text" name="search" placeholder="Search anything..">
								<button class="btn btn-primary btn-small" type="submit">Search</button>
							</form>
						</li>
					</ul>
				</div>
				<!-- header search ends-->
			</nav><!-- NAVBAR ENDS-->
		</div>
	</header>
	<!--/header-->

<div class="main-wrapper pages">
	<!-- BREDCRUMB -->
	<section class="bredcrumb" id="bredcrumb">
		<div class="bg-image text-center" style="background-image: url('img/1920x500.jpg');">
			<h1>Product</h1>
			<ul>
				<li>Home</li>
				<li><a href="javascript:void(0)">Product</a></li>
			</ul>
		</div>
	</section>

	<!-- OUR Product -->
	<section class="home-team" id="product">
		<div class="container">
			<!-- section title -->
			<div class="row">
				<div class="col-md-8 offset-md-2">
					<div class="sectionTitle text-center">
						<h2>Our Product</h2>
						<p>Lorem ipsum dolor sit amet consectetur adipisicing elit sed do eiusm temp</p>
					</div>
				</div>
			</div>

				<div>
                    <div class="form-group">
                        <label>Search Product</label>
                        <input type="text" class="form-control" style="
                        display: inline-block;
                        width: 70%;
                        margin-left: 2em;
                        margin-right: 1em;
                    	" data-text-search>
                        <button type="submit" class="btn btn-default" data-search="">Search</button>
                    </div>
                </div>

                <div> Filter By:
                    <div class="radio">
                        <label>
                            <input type="radio" name="filter" value="pd.name" checked="">Name</label>
                        <label>
                            <input type="radio" name="filter" value="p.price">Price</label>
                    </div>
                    <div class="radio">
                        <label>
                            <input type="radio" name="orderby" value="ASC" checked="">Ascending</label>
                        <label>
                            <input type="radio" name="orderby" value="DESC">Descending</label>
                    </div>
	        	</div>
	        	<input type="hidden" id="rowpage" name="rowpage" value="0" data-text-row-page>
	        <br>
			<!-- section title ends -->
			<div class="row" data-product-container>
				<div class="col-md-6 col-lg-3" data-default-item>
					<div class="card card-style2 team-card">
						<div class="card_img">
							<div style="position: relative; width: 100%; height:200px; padding-right: 10px; margin-right: 10px;">
								<center><img src="http://placehold.it/321x360" alt="Card image" data-image class="img-responsive" style="max-height: 200px"></center>
							</div>
							<div class="hover-overlay effect-scale">
								<a href="#" class="overlay_icon" data-link><i class="fa fa-link"></i></a>
							</div>
						</div>
						<div class="row" style="padding-top: 10px">
		                    <div class="col-md-12 col-sm-12">
		                        <center>
		                        <button data-add="" class="btn btn-white btn-primary"><i class="fa fa-shopping-cart ui-droppable"></i> Add To Cart</button>
		                        </center>
		                    </div>
		                </div>
						<div>
							<h4 class="card-title text-center" data-title>$45</h4>
							<a href="#"><h4 class="card-title text-center" data-price>$45</h4></a>
							<!--p data-short-desc></p-->
						</div>
					</div>
				</div>

				<div class="col-md-6 col-lg-3">
					<div class="card card-style2 team-card">
						<div class="card_img">
							<img class="img-full" src="http://placehold.it/321x360" alt="Card image">
							<div class="hover-overlay effect-scale">
								<a href="#" class="overlay_icon"><i class="fa fa-link"></i></a>
							</div>
						</div>
						<div>
							<a href="#"><h4 class="card-title text-center">$45</h4></a>
						</div>
					</div>
				</div>
				
				<div class="col-md-6 col-lg-3">
					<div class="card card-style2 team-card">
						<div class="card_img">
							<img class="img-full" src="http://placehold.it/321x360" alt="Card image">
							<div class="hover-overlay effect-scale">
								<a href="#" class="overlay_icon"><i class="fa fa-link"></i></a>
							</div>
						</div>
						<div>
							<a href="#"><h4 class="card-title text-center">$45</h4></a>
						</div>
					</div>
				</div>

				<div class="col-md-6 col-lg-3">
					<div class="card card-style2 team-card">
						<div class="card_img">
							<img class="img-full" src="http://placehold.it/321x360" alt="Card image">
							<div class="hover-overlay effect-scale">
								<a href="#" class="overlay_icon"><i class="fa fa-link"></i></a>
							</div>
						</div>
						<div>
							<a href="#"><h4 class="card-title text-center">$45</h4></a>
						</div>
					</div>
				</div>

				<div class="col-md-6 col-lg-3">
					<div class="card card-style2 team-card">
						<div class="card_img">
							<img class="img-full" src="http://placehold.it/321x360" alt="Card image">
							<div class="hover-overlay effect-scale">
								<a href="#" class="overlay_icon"><i class="fa fa-link"></i></a>
							</div>
						</div>
						<div>
							<a href="#"><h4 class="card-title text-center">$45</h4></a>
						</div>
					</div>
				</div>

				<div class="col-md-6 col-lg-3">
					<div class="card card-style2 team-card">
						<div class="card_img">
							<img class="img-full" src="http://placehold.it/321x360" alt="Card image">
							<div class="hover-overlay effect-scale">
								<a href="#" class="overlay_icon"><i class="fa fa-link"></i></a>
							</div>
						</div>
						<div>
							<a href="#"><h4 class="card-title text-center">$45</h4></a>
						</div>
					</div>
				</div>

				<div class="col-md-6 col-lg-3">
					<div class="card card-style2 team-card">
						<div class="card_img">
							<img class="img-full" src="http://placehold.it/321x360" alt="Card image">
							<div class="hover-overlay effect-scale">
								<a href="#" class="overlay_icon"><i class="fa fa-link"></i></a>
							</div>
						</div>
						<div>
							<a href="#"><h4 class="card-title text-center">$45</h4></a>
						</div>
					</div>
				</div>

				<div class="col-md-6 col-lg-3">
					<div class="card card-style2 team-card">
						<div class="card_img">
							<img class="img-full" src="http://placehold.it/321x360" alt="Card image">
							<div class="hover-overlay effect-scale">
								<a href="#" class="overlay_icon"><i class="fa fa-link"></i></a>
							</div>
						</div>
						<div>
							<a href="#"><h4 class="card-title text-center">$45</h4></a>
						</div>
					</div>
				</div>

			</div>
		</div>
		<center><div class="pagination" tampilkan-data></div></center>  
	</section>

	<!-- FOOTER -->
	<footer class="footer footer-classic bg-dark">
		<div class="container">
			<div class="row">
				<div class="col-md-3">
					<div class="footer-text">
						<a href="#"><img class="footer-logo" src="img/logo.png" alt="footer logo"></a>
						<p>
							Lorem ipsum dolor sit amet consectetur adipisicing elit sed do eiusmod tempor incididunt ut labore et dolore magna aliqua ut enim ad minim veniam quis nostrud exercitation.
						</p>
						<div class="social-icons">
							<a href="#" class="btn btn-social btn-social-o twitter">
								<i class="fa fa-twitter"></i>
							</a>
							<a href="#" class="btn btn-social btn-social-o linkedin">
								<i class="fa fa-linkedin"></i>
							</a>
							<a href="#" class="btn btn-social btn-social-o facebook">
								<i class="fa fa-facebook-f"></i>
							</a>
							<a href="#" class="btn btn-social btn-social-o skype">
								<i class="fa fa-skype"></i>
							</a>
							<a href="#" class="btn btn-social btn-social-o pinterest">
								<i class="fa fa-pinterest-p"></i>
							</a>
						</div>
					</div>
				</div>
				<div class="col-xl-2 col-md-2">
					<div class="links">
						<h3>Links</h3>
						<ul class="">
							<li><a href="#">Home</a></li>
							<li><a href="#">Profile</a></li>
							<li><a href="#">Contact</a></li>
							<li><a href="#">Product</a></li>
							<li><a href="#">Gallery</a></li>
						</ul>
					</div>
				</div>
				<div class="col-md-3">
					<div class="location">
						<h3>Location</h3>
						<ul>
							<li>Excepteur sint occaecat cupidat non proident sunt.</li>
							<li><i class="fa fa-home"></i> Jl. Coblong Timur,</li>
							<li><i class="fa fa-phone"></i> <a href="tel:+62 22 20525693">+62 22 20525693</a></li>
							<li><i class="fa fa-envelope"></i> <a href="mailto.html"> info@example.com </a></li>
						</ul>
					</div>
				</div>
				<div class="col-md-4">
					<div class="instagram">
						<h3>Gallery</h3>
						<ul class="row instagram-image qw-list-item">
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-1.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-2.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-3.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-4.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-5.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4"><a href="#"><img src="img/gallery/image-6.jpg" alt="insta"></a></li>
							<li class="col-xs-4 col-4 qw-list-default"><a href="#"><img src="img/gallery/image-7.jpg" alt="insta"></a></li>
						</ul>
					</div>
				</div>

				<!-- COPY RIGHT -->
			</div>
			<div class="copyright">
				<hr>
				<div class="row">
					<div class="col-sm-6 offset-sm-3">
						<div class="copyRight_text text-center">
							<p> &copy; 2017 Copyright Web Builder.</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</footer>
</div>


<!-- JAVASCRIPTS -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbo8AqPhlblo2nbndho2I8zLzr0o9Qs28"></script>
<script src="plugins/jquery/jquery.min.js"></script>
<script src="plugins/jquery/jquery-migrate-3.0.0.min.js"></script>
<script src="plugins/bootstrap/js/tether.min.js"></script>
<script src="plugins/bootstrap/js/bootstrap.min.js"></script>
<script src="plugins/selectbox/jquery.selectbox-0.1.3.min.js"></script>
<script src="plugins/slick/slick.min.js"></script>
<script src="js/Chart.min.js"></script>
<script src="plugins/circle-progress/jquery.appear.js"></script>
<script src="plugins/isotope/isotope.min.js"></script>
<script src="plugins/fancybox/jquery.fancybox.min.js"></script>
<script src="js/waypoints.min.js"></script>
<script src="plugins/counterUp/jquery.counterup.js"></script>
<script src="plugins/smoothscroll/SmoothScroll.js"></script>
<script src="plugins/velocity/velocity.min.js"></script>
<script src="plugins/datepicker/bootstrap-datepicker.min.js"></script>
<script src="plugins/syotimer/jquery.syotimer.min.js"></script>
<script src="js/custom.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

	<style>
        [data-default-item] {
            display: none;
        }
    </style>

    <script>
        $(function () {
            loadproduct()
            getCustomerById()

            //tambah tombol search
            $('[data-search]').click(function () {
                loadproduct()
            })


            // input change
            $('.radio input').change(function (e) {
                loadproduct()
            })
        })

        async function getCustomerById() {
          let scid = await getClientServiceID()
              customer_id = await getCustomer()

          if(customer_id){
            return $.post('https://build.web.id/api/customers/getCustomerdatabyId/', {
              client_id: scid.cid,
              service_id: scid.layanan_id,
              customer_id: customer_id
            }).then(res => {
                $('[data-login]').html(res.data.firstname+' <b class="caret"></b>')
                $('[data-account]').hide()
            })
          }else{
            $('[data-login]').hide()
            $('[data-account]').show()
          }
        }

        async function loadproduct() {
            var
                scid = await getClientServiceID()
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                set_setting = await getConfigCurrency(scid.cid, scid.layanan_id),

            // delete html
            $('[data-product-container]')
                .children()
                .not('[data-default-item]')
                .remove()

            let name = $('[data-text-search]').val()
            let filter = $('[name="filter"]:checked').val()
            let sort = $('[name="orderby"]:checked').val()
            let page = $('[data-text-row-page]').val()
            let limit = 12
            let prod = await getProduct(cid, sid, name, filter, sort, '', '')
            let products = await getProduct(cid, sid, name, filter, sort, page, limit)

            jumlah_product = products.length
            jumlah_page = Math.ceil(prod.length/limit, 1)
            
            //tampilkan paging product
            $('[tampilkan-data]').html(makePaging(jumlah_page,page))

            products.forEach(product => {
                let
                    clone = $('[data-default-item]').clone(),
                    modified_clone = clone.removeAttr('data-default-item'),
                    short_desc = product.description.substring(0, 50),
                    link = `./product-detail.html?pid=${product.product_id}`
                    if(set_setting.code=='IDR'){
                        price = parseInt(product.price).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                    }else{
                        price = (product.price/set_setting.value).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                    }
                    
                modified_clone.find('[data-image]').attr('src', product.image)
                modified_clone.find('[data-title]').html(product.name)
                modified_clone.find('[data-price]').text(set_setting.symbol_left+' '+price)
                modified_clone.find('[data-short-desc]').html(short_desc)
                modified_clone.find('[data-link]').attr('href', link)
                modified_clone.find('[data-add]').attr('onclick','saveCart('+product.product_id+')');

                $('[data-product-container]').append(modified_clone)
            })

        }

        async function saveCart(product_id) {
            let
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                pid = parseInt(product_id),
                customer_id = await getCustomer()

            if(customer_id){
                $.post('https://build.web.id/api/cart/add/', {
                    client_id: cid,
                    service_id: sid,
                    customer_id: customer_id,
                    product_id: pid,
                }, function (res, status) {
                    if(res.status==false){
                        swal("Product not found!", "Silahkan pilih product!", "info")
                        .then((value) => {
                          window.location.href = "product.html";
                        });
                    }else{
                       swal("Cart add!", "Successfully Add To Cart!", "success") 
                    }
                }).fail(res => {
                    console.log(res.responseText)
                })
            }else{
                swal("Anda belum login!", "Silahkan login terlebih dahulu!", "info")
                .then((value) => {
                    window.location.href = "login.html";
                });
            }
        }

        function getCustomer(){
            return $.post('getdata.php').then(function(customer_id){
                return customer_id
            })
        }

        function getClientServiceID() {
            return $.post('scid.txt')
                .then(res => {
                    return JSON.parse(res)
                })
        }

        // Change : perubahan ada disini
        function getProduct(cid, sid, name, filter, sort, page, limit) {
            if(page==0){
                start = 0;
            }else{
                start = page*limit;
            }
            
            let data = {
                client_id: cid,
                service_id: sid,
                filter_name: name,
                sort: filter,
                order: sort,
                start: start,
                limit: limit
            }
            
            return $.post('https://build.web.id/api/product/data/', data).then(res => {
                return res.data
            })
        }

        function getConfigCurrency(cid, sid){
            return $.post('https://build.web.id/api/setting/getLocalSetting/', {
                client_id: cid,
                service_id: sid
            }).then(res => {
                return res.data.config_currency
            })
        }

        function makePaging(totalPages, pageIndex) {
            var oPaging, i, j, k;
            var totalPages = parseInt(totalPages);

            pageIndex++;

            i = pageIndex;
            j = pageIndex - 1;
            k = pageIndex + 1;

            var oBefore, oAfter;
            oBefore = "";
            oAfter = "";

            while (j != 0 && j != i - 6) {
                oBefore = "<a class='Page' onClick='changePage("+(j-1)+")' data-index='"+(j-1)+"'>"+j+"</a>&nbsp;"+oBefore;
                j--;
            }

            for (; k < totalPages + 1 && k < i + 6; k++) {
                oAfter += "<a class='Page' onClick='changePage("+(k-1)+")' data-index='"+(k-1)+"'>"+k+"</a>&nbsp;";
            }

            oPaging = oBefore + "<a class='CurPage' href='#' rel='' style='color:Red;'>" + i.toString() + "</a>&nbsp;" + oAfter;
            return oPaging;
        }

        function changePage(page){
            $('[data-text-row-page]').val(page)
            loadproduct()
        }
    </script>
</body>
<style type="text/css">
    .pagination {
        display: inline-block;
    }

    .pagination a {
        color: black;
        float: left;
        padding: 8px 16px;
        text-decoration: none;
        border: 1px solid #ddd;
    }

    .pagination a.active {
        background-color: #4CAF50;
        color: white;
        border: 1px solid #4CAF50;
    }

    .pagination a:hover:not(.active) {background-color: #ddd;}

    .pagination a:first-child {
        border-top-left-radius: 5px;
        border-bottom-left-radius: 5px;
    }

    .pagination a:last-child {
        border-top-right-radius: 5px;
        border-bottom-right-radius: 5px;
    }
</style>

</html>