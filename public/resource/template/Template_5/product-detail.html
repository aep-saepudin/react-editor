<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport"    content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author"      content="Sergey Pozhilov (GetTemplate.com)">

	<title>Web Builder Template</title>

	<link rel="shortcut icon" href="assets/images/favicon.png">

	<!-- Bootstrap -->
	<link href="assets/css/bootstrap.no-icons.min.css" rel="stylesheet">
	<!-- Icons -->
	<link href="assets/css/font-awesome.css" rel="stylesheet">
	<!-- Fonts -->
	<link href="assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!-- Custom styles -->
	<link rel="stylesheet" href="assets/css/styles.css">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/jquery-bar-rating/1.2.2/themes/fontawesome-stars.min.css" rel="stylesheet">

	<!--[if lt IE 9]> <script src="assets/js/html5shiv.js"></script> <![endif]-->
</head>
<body>

<header id="header">
	<div id="head" class="parallax qw-section" parallax-speed="2">
		<h1 id="logo" class="text-center" style="color: white;">
			<span class="title">Our Product Detail</span>
			<span class="tagline">Example Tagline<br>
				<a href="#">example.blabla@example.com</a></span>
		</h1>
	</div>
	<nav class="navbar navbar-default navbar-sticky" style="margin-bottom: 0px">
		<div class="container-fluid">

			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
			</div>

			<div class="navbar-collapse collapse">

				<ul class="nav navbar-nav qw-list-item">
					<li><a href="index.html">Home</a></li>
					<li><a href="profile.html">Profile</a></li>
					<li><a href="contact.html">Contact</a></li>
					<li><a href="product.html">Product</a></li>
					<li><a href="gallery.html">Gallery</a></li>
					<li class="qw-list-default"><a href="default.html">Default</a></li>
					<li class="dropdown active">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" data-account>Account<b class="caret"></b></a>
						<ul class="dropdown-menu">
							<li><a href="sign-up.html">Sign Up</a></li>
							<li><a href="login.html">Login</a></li>
						</ul>
					</li>
					<li class="dropdown active">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" data-login>My Account<b class="caret"></b></a>
						<ul class="dropdown-menu">
							<li><a href="account.html">My Account</a></li>
							<li><a href="change-pass.html">Change Password</a></li>
							<li><a href="address-book.html">Address Book</a></li>
							<li><a href="view-cart.html">List Cart</a></li>
							<li><a href="whistlist.html">Whist List</a></li>
							<li><a href="order-history.html">Order History</a></li>
							<li><a href="rewards-points.html">Rewards Points</a></li>
							<li><a href="transactions.html">Transactions</a></li>
						</ul>
					</li>
				</ul>

			</div><!--/.nav-collapse -->
		</div>
	</nav>
</header>

<main id="main">
<section id="product-detail" style="padding-top: 30px">
	<div class="container">
		<div class="row bottom">
			<div class="preview col-md-6">
				<div id="myCarousel" class="carousel slide" data-ride="carousel">
			    <!-- Indicators -->
			    <ol class="carousel-indicators">
			      <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
			      <li data-target="#myCarousel" data-slide-to="1"></li>
			      <li data-target="#myCarousel" data-slide-to="2"></li>
			    </ol>

			    <!-- Wrapper for slides -->
			    <div class="carousel-inner">
			      <div class="item active">
			        <img src="http://placehold.it/488x300" alt="Image" style="width:100%;" data-qw-image="">
			      </div>

			      <div class="item">
			        <img src="http://placehold.it/510x315" alt="Image" style="width:100%;">
			      </div>
			    
			      <div class="item">
			        <img src="http://placehold.it/510x315" alt="Image" style="width:100%;">
			      </div>
			    </div>

			    <!-- Left and right controls -->
			    <a class="left carousel-control" href="#myCarousel" data-slide="prev">
			      <!-- <span class="fa fa-chevron-left"></span> -->
			      <span class="sr-only">Previous</span>
			    </a>
			    <a class="right carousel-control" href="#myCarousel" data-slide="next">
			      <!-- <span class="fa fa-chevron-right"></span> -->
			      <span class="sr-only">Next</span>
			    </a>
			  </div>
			</div>
			<div class="details col-md-6">
				<h3 class="product-title" data-qw-title="">men's shoes fashion</h3>
				<div class="rating">
					<div class="stars">
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star checked"></span>
						<span class="fa fa-star"></span>
						<span class="fa fa-star"></span>
					</div>
					<span class="review-no">41 reviews</span>
				</div>
				<p class="product-description">Suspendisse quos? Tempus cras iure temporibus? Eu laudantium cubilia sem sem! Repudiandae et! Massa senectus enim minim sociosqu delectus posuere.</p>
				<h4 class="price" data-qw-price="">current price: <span>$180</span></h4>
				<p class="vote"><strong>91%</strong> of buyers enjoyed this product! <strong>(87 votes)</strong></p>
				<div class="action">
					<button class="btn btn-white btn-primary add-whistlist" data-wish="">
                        <i class="fa fa-heart-o"></i>
                        <span>Save To Favorite</span>
                    </button>
					<button class="btn btn-primary" type="button" data-add="">add to cart</button>
					<a href="view-cart.html"><button class="btn btn-primary" type="button" data-link>view cart</button></a>
				</div>
			</div>
		</div>
		<div class="row bottom">
				<div class="col-md-12">
					<ul class="nav nav-tabs" role="tablist">
						<li class="nav-item">
							<a class="nav-link active" data-toggle="tab" href="#des" role="tab">Description</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" data-toggle="tab" href="#speci" role="tab">Specification</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" data-toggle="tab" href="#review" role="tab">Reviews (<span data-count-review>0</span>)</a>
						</li>
					</ul>

					<!-- Tab panes -->
					<div class="tab-content">
						<div class="tab-pane active" id="des" role="tabpanel" data-qw-description="">
							<p>
								Lorem ipsum dolor sit amet, consectetur adipisicing elit. Voluptatibus, alias veniam. Beatae nisi illum explicabo minima, voluptatem earum alias dolores, laboriosam vitae hic et ducimus optio dicta quasi assumenda necessitatibus, quas rerum enim qui, ab. Magni id omnis tenetur, nulla, error expedita delectus saepe possimus nam fugiat praesentium voluptatem autem!</p>
							<p>
								Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
								tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
								quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
								consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
								cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
								proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
							</p>
						</div>
						<div class="tab-pane" id="speci" role="tabpanel">
							<table class="table table-striped">
								<tbody>
									<tr>
										<td><b>Example</b></td>
										<td>Example</td>
									</tr>
									<tr>
										<td><b>Example</b></td>
										<td>Example</td>
									</tr>
									<tr>
										<td><b>Example</b></td>
										<td>Example</td>
									</tr>
									<tr>
										<td><b>Example</b></td>
										<td>Example</td>
									</tr>
									<tr>
										<td><b>Example</b></td>
										<td>Example</td>
									</tr>
								</tbody>
							</table>
						</div>
						<div class="tab-pane" id="review" role="tabpanel">
							<style>
                                #qw-add-review .br-wrapper {
                                    margin-left: 4em;
                                    margin-top: -1.4em;
                                }
                                #qw-view-review [data-default-review] {
                                    display: none;
                                }
                                #qw-view-review .btn-group:last-child {
                                    float: right;
                                }
                                #qw-view-review .btn-group [data-delete-review]:hover {
                                    background: red;
                                }
                                #qw-view-review .btn-group [data-edit-review]:hover {
                                    background: #337ab7;
                                }
                                #qw-view-review [data-save-group] {
                                    display: none;
                                }
                                #qw-view-review [contenteditable="true"] {
                                    border: 1px solid #00BCD4
                                }
                            </style>

                            <div id="qw-view-review" data-container>
                                <hr>
                                <div class="media comment_section" data-default-review data-item>

                                    <div class="media-body post_reply_comments" style="width: auto;border: 1px solid #f2f2f2;background:#fffefe;border-radius: 0.5em;padding: 10px">
                                        <h5 data-name>Marsh</h5>
                                        <select class="qw-review">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                        </select>

                                        <template data-review-id></template>
                                        
                                        <div data-date style="font-size: smaller;">NOVEMBER 9, 2013 AT 9:15 PM</div>
                                        <div data-text style="font-size: smaller;">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor
                                            incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                                            nostrud
                                        </div>

                                        <div class="btn-group" role="group" data-save-group>
                                            <button class="btn btn-primary" data-save-review="">
                                                save
                                            </button>
                                            <button class="btn btn-success" data-cancel-review="">
                                                cancel
                                            </button>
                                        </div>

                                        <div class="btn-group" role="group">
                                            <button class="btn" data-edit-review>
                                                <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                                            </button>
                                            <button class="btn" data-delete-review>
                                                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="qw-add-review">

                                <hr>
                                <div class="row">

                                    <div class="col-sm-12">
                                        <div class="form-group">
                                            <label style="font-size: x-large;">Add Review</label>
                                            <br>
                                            <div style="margin-right: 1em;">
                                                <span style="margin-right: 1em;">Rating: </span>
                                                <select id="qw-add-review-star">
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                </select>
                                            </div>
                                            <template data-review-id></template>
                                            <textarea name="message" id="message" required="required" class="form-control" rows="8" data-teks-review></textarea>
                                        </div>
                                        <div class="form-group">
                                            <button type="submit" class="btn btn-primary btn-lg readmore" required="required" data-add-button>Submit Review</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
						</div>						
					</div>
				</div>
			</div>
	</div>
</section>
</main>

<footer id="footer">
	<div class="container">
		<div class="row">
			<div class="col-md-3 widget">
				<h3 class="widget-title">Contact</h3>
				<div class="widget-body">
					<p>+622152905148<br>
						<a href="mailto:#">example.blabla@example.com</a><br>
						<br>
						Jl. Coblong Selatan Bandung
					</p>
				</div>
			</div>

			<div class="col-md-3 widget">
				<h3 class="widget-title">Follow me</h3>
				<div class="widget-body">
					<p class="follow-me-icons">
						<a href="#"><i class="fa fa-twitter fa-2"></i></a>
						<a href="#"><i class="fa fa-dribbble fa-2"></i></a>
						<a href="#"><i class="fa fa-github fa-2"></i></a>
						<a href="#"><i class="fa fa-facebook fa-2"></i></a>
					</p>
				</div>
			</div>

			<div class="col-md-3 widget">
				<h3 class="widget-title">Text widget</h3>
				<div class="widget-body">
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Atque, nihil natus explicabo ipsum quia iste aliquid repellat eveniet velit ipsa sunt libero sed aperiam id soluta officia asperiores adipisci maxime!</p>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Atque, nihil natus explicabo ipsum quia iste aliquid repellat eveniet velit ipsa sunt libero sed aperiam id soluta officia asperiores adipisci maxime!</p>
				</div>
			</div>

			<div class="col-md-3 widget">
				<h3 class="widget-title">Form widget</h3>
				<div class="widget-body">
					<p>+622152905148<br>
						<a href="mailto:#">example.blabla@example.com</a><br>
						<br>
						Jl. Coblong Selatan Bandung
					</p>
				</div>
			</div>

		</div> <!-- /row of widgets -->
	</div>
	<div class="container">
		<div class="row">

			<div class="col-md-6 widget">
				<div class="widget-body">
					<p>BDG JUARA </p>
				</div>
			</div>

			<div class="col-md-6 widget">
				<div class="widget-body">
					<p class="text-right">
						Copyright &copy; 2017, Web Builder Template<br>
						Design: <a href="#" rel="designer">Web Builder Template</a> </p>
				</div>
			</div>

		</div> <!-- /row of widgets -->
	</div>
</footer>
<a id="back-to-top" href="#" class="btn btn-primary back-to-top" role="button" title="Click to return on the top page" data-toggle="tooltip" data-placement="left"><span class="fa fa-arrow-up"></span></a>

<!-- JavaScript libs are placed at the end of the document so the pages load faster -->

<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/template.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-bar-rating/1.2.2/jquery.barrating.min.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            LoadReviews()
            loadToHTML()
            getCustomerById()
            console.log('[qw-inject.js] Loaded')
        })
        /** 
         * 
         * @returns {number} PID
         */
        function getPIDFromUrl() {
            var urlParams = new URLSearchParams(window.location.search)
            return urlParams.get("pid")
        }
        /**
         * Algoritma
         * -------------------------
         * - Get ClientID and Service ID from HTML>
         * - Use it to Create Request to Get Product
         */
        function getClientServiceID() {
            return $.post('scid.txt')
                .then(res => {
                    return JSON.parse(res)
                })
        }
        function getProduct(cid, sid, pid) {
            return $.post('https://build.web.id/api/product/select', {
                client_id: cid,
                service_id: sid,
                pid: pid
            })
        }
        function getProductAttribut(cid, sid, pid) {
            return $.post('https://build.web.id/api/product/attribute/', {
                client_id: cid,
                service_id: sid,
                product_id: pid
            })
        }
        function getProductImage(cid, sid, pid) {
            return $.post('https://build.web.id/api/product/image/', {
                client_id: cid,
                service_id: sid,
                product_id: pid
            })
        }

        async function getCustomerById() {
          let scid = await getClientServiceID()
              customer_id = await getCustomer()

          if(customer_id){
            return $.post('https://build.web.id/api/customers/getCustomerdatabyId/', {
              client_id: scid.cid,
              service_id: scid.layanan_id,
              customer_id: customer_id
            }).then(res => {
                $('[data-login]').html(res.data.firstname+' '+res.data.lastname+' <b class="caret"></b>')
                $('[data-account]').hide()
            })
          }else{
            $('[data-login]').hide()
            $('[data-account]').show()
          }
        }

        async function loadToHTML() {
            var
                ssid = await getClientServiceID(),
                cid = window.atob(ssid.cid),
                sid = window.atob(ssid.layanan_id),
                pid = getPIDFromUrl()
                set_setting = await getConfigCurrency(ssid.cid, ssid.layanan_id),
                product = await getProduct(cid, sid, pid)
                spesification = await getProductAttribut(cid, sid, pid)
                //product_spec = spesification.data.Technical.Spesification
                image_arr = await getProductImage(cid, sid, pid)

            if(set_setting.code=='IDR'){
                price = parseInt(product.data.price).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
            }else{
                price = (product.data.price/set_setting.value).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
            }

            $('[data-qw-title]').text(product.data.name)
            $('[data-qw-price]').text(set_setting.symbol_left+' '+price)
            $('[data-qw-description]').html(product.data.description)
            $('[data-qw-image]').attr('src', product.data.image)
            //$('[data-qw-spesification]').html(product_spec)

            image_arr = image_arr.data;
            /*image_arr.forEach(images => {
                let clone = $('[data-image-item]').clone(),
                    modified_clone = clone.removeAttr('data-image-item');
                    
                modified_clone.find('[data-qw-image]').attr('src', images.image)
                $('[data-image-container]').append(modified_clone)
            })*/
        }
    </script>

    <script>
        // Check if this product favoritable
        isThisFavorited().then(res => {
            if (res) {
                $('[data-wish]').find('i').attr('class', 'fa fa-heart')
                $('[data-wish]').find('span').text('Favorited')
            } else {
                $('[data-wish]').find('i').attr('class', 'fa fa-heart-o')
                $('[data-wish]').find('span').text('Save To Favorite')
            }
        })
        // Cart button
        $('[data-add]').click(function (e) {
            saveCart()
        })
        // Favorite Button
        $('[data-wish]').click(function (e) {
            // add to wishlist
            addwishlist().then(res => {
                // if success 
                if (res.status == true) {
                    // change Icon and Text to Favorited
                    $(this).find('i').attr('class', 'fa fa-heart')
                    $(this).find('span').text('Favorited')
                } else {
                    // if respon false remove current favorite
                    removewishlist().then(res => {
                        //change Icon and Text to Save To Favorite
                        $(this).find('i').attr('class', 'fa fa-heart-o')
                        $(this).find('span').text('Save To Favorite')
                    })
                }
            })
        })
        async function saveCart() {
            let
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                pid = parseInt(getPIDFromUrl()),
                customer_id = await getCustomer()
            
            if(customer_id){
                $.post('https://build.web.id/api/cart/add/', {
                    client_id: cid,
                    service_id: sid,
                    customer_id: customer_id,
                    product_id: pid,
                }, function (res, status) {
                    console.log(res, status)
                    swal("Good job!", "Successfully Add To Cart!", "success")
                }).fail(res => {
                    console.log(res.responseText)
                })
            }else{
                swal("Anda belum login!", "Silahkan login terlebih dahulu!", "info")
                .then((value) => {
                    window.location.href = "login.html";
                });
            }
        }
        async function addwishlist() {
            let
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                pid = parseInt(getPIDFromUrl()),
                customer_id = await getCustomer()
            return $.post('https://build.web.id/api/wishlist/add/', {
                client_id: cid,
                service_id: sid,
                customer_id: customer_id, // Todo Ganti nanti ya
                product_id: pid,
            }).then(res => {
                return res
            })
        }
        async function removewishlist() {
            let
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                pid = parseInt(getPIDFromUrl()),
                customer_id = await getCustomer()
            return $.post('https://build.web.id/api/wishlist/remove/', {
                client_id: cid,
                service_id: sid,
                customer_id: customer_id, // Todo Ganti nanti ya
                product_id: pid,
            }).then(res => {
                return res
            })
        }
        async function isThisFavorited() {
            let
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                pid = parseInt(getPIDFromUrl()),
                customer_id = await getCustomer()
            return $.post('https://build.web.id/api/wishlist/data/', {
                client_id: cid,
                service_id: sid,
                customer_id: customer_id, // Todo Ganti nanti ya
            }).then(res => {
                let found = false
                res.data.forEach(element => {
                    if (element.product_id == pid) {
                        found = true
                    }
                })
                return found
            })
        }
        function getCostumerID() {
            return $.post('getdata.php')
                .then(res => {
                    return res
                })
        }
        // Get Review ========================>
        const getCountReview = async() => {
            let
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                pid = getPIDFromUrl()
            return $.post('https://build.web.id/api/review/product/', {
                client_id: cid,
                service_id: sid,
                product_id: pid
            }).then(res => res.count)
        }
        // Ambil data dari server
        const getReviews = async() => {
            let
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                pid = getPIDFromUrl()
            return $.post('https://build.web.id/api/review/product/', {
                client_id: cid,
                service_id: sid,
                product_id: pid
            }).then(res => res.data)
        }
        const DEFAULT_ITEM = 'data-default-review'
        const DEFAULT_ITEM_SELECTOR = '[data-default-review]'
        const CONTAINER = 'data-container'
        const CONTAINER_SELECTOR = '[data-container]'
        async function LoadReviews() {
            const
                reviews = await getReviews(),
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                pid = getPIDFromUrl(),
                count = await getCountReview(),
                customer_id = await getCustomer()

            default_scid = {
                client_id: cid,
                service_id: sid
            }
            const setting_rating = {
                theme: 'fontawesome-stars',
                readonly: true
            }
            //console.log(reviews);
            //console.log(reviews[0].review_id);
            $(CONTAINER_SELECTOR).children().not(DEFAULT_ITEM_SELECTOR).remove()
            $('[data-count-review]').text(count)
            
            reviews.forEach(review => {
                let
                    cloner = getCloner(),
                    name = review.author,
                    teks = review.text,
                    rating = review.rating,
                    date = review.date_added,
                    id = review.review_id

                cloner.find('[data-name]').text(name)
                cloner.find('[data-date]').text(date)
                cloner.find('[data-text]').html(teks)
                cloner.find('[data-review-id]').text(id)
                cloner.find('.qw-review').barrating(setting_rating)
                cloner.find('.qw-review').barrating('set', rating)
                // Event Listener
                cloner.find('[data-delete-review]').click(e => {
                    let id = cloner.find('[data-review-id]').text()
                    var param_add = Object.assign({}, default_scid);
                    param_add.review_id = id
                    swal({
                            title: "Are you sure?",
                            text: "Once deleted, you will not be able to recover this review!",
                            icon: "warning",
                            buttons: true,
                            dangerMode: true,
                        })
                        .then((willDelete) => {
                            if (willDelete) {
                                $.post('https://build.web.id/api/review/remove/', param_add,
                                    function (res) {
                                        if (res.status) {
                                            swal("Poof! Your imaginary file has been deleted!", {
                                                icon: "success",
                                            })
                                            let currentitem = $(e.target).closest('[data-item]')
                                            currentitem.fadeOut(400)
                                        }
                                    })
                            }
                        })
                })
                var
                    oldtext = "",
                    oldrating = 0
                cloner.find('[data-edit-review]').click(e => {
                    let thisItem = $(e.target).closest('[data-item]')
                    let text = thisItem.find('[data-text]').text()
                    let rating = thisItem.find('.qw-review').val()
                    thisItem.find('[data-text]').attr('contentEditable', true)
                    thisItem.find('.qw-review').barrating('readonly', false)
                    thisItem.find('[data-save-group]').show()
                    thisItem.find('[data-text]').focus()
                    
                    oldtext = text
                    oldrating = rating
                })
                cloner.find('[data-save-review]').click(e => {
                    let thisItem = $(e.target).closest('[data-item]')
                    let
                        text = thisItem.find('[data-text]').text(),
                        rating = thisItem.find('.qw-review').val(),
                        review_id = cloner.find('[data-review-id]').text()
                    let param_save = Object.assign({}, default_scid)
                    param_save.product_id = pid
                    param_save.text = text
                    param_save.rating = rating
                    param_save.customer_id = customer_id
                    param_save.review_id = review_id
                    $.post('https://build.web.id/api/review/update', param_save, function (res) {
                            if (res.status) {
                                thisItem.find('[data-text]').attr('contentEditable', false)
                                thisItem.find('.qw-review').barrating('readonly', true)
                                thisItem.find('[data-save-group]').hide()
                            }
                        })
                        .done((res) => {
                            if (res.status) {
                                swal("Good job!", "Succesfully Update!", "success")
                            }
                        })
                        .error(xhr => console.log(xhr))
                })
                cloner.find('[data-cancel-review]').click(e => {
                    cloner.find('[data-text]').text(oldtext)
                    cloner.find('.qw-review').barrating('set', oldrating)
                    cloner.find('[data-text]').attr('contentEditable', false)
                    cloner.find('.qw-review').barrating('readonly', true)
                    cloner.find('[data-save-group]').hide()
                })
                $(CONTAINER_SELECTOR).append(cloner)
            })
            initilizingReview()
        }
        const getCloner = () => {
            let clone = $(DEFAULT_ITEM_SELECTOR).clone()
            return clone.removeAttr(DEFAULT_ITEM)
        }
        /**
         * Change Normal select tag to Rating Star
         * - type    : Side Effect 
         * - Library : http://antenna.io/demo/jquery-bar-rating/examples/
         **/
        const initilizingReview = () => {
            $('#qw-add-review-star').barrating({
                theme: 'fontawesome-stars'
            })
        }
        // Add Review ========================>
        $('[data-add-button]').click(e => {
            addReview()
        })

        async function addReview() {
            let
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                pid = getPIDFromUrl(),
                customer_id = await getCustomer(),
                teks = $('[data-teks-review]').val(),
                rating = $('#qw-add-review-star').val()
            
            if(customer_id){
                let name = await getNameCostumer()
                $.post('https://build.web.id/api/review/add/', {
                    client_id: cid,
                    service_id: sid,
                    customer_id: customer_id,
                    product_id: pid,
                    author: name,
                    text: teks,
                    rating: rating,
                }, res => {
                    if (res.status) {
                        //swal("Good job!", "Review Succesfully Added!", "success")
                        $('[data-teks-review]').val("")
                        $('#qw-add-review-star').barrating('set', 1)
                        LoadReviews()
                    }
                    //console.log(res)
                })
            }else{
                swal("Anda belum login!", "Silahkan login terlebih dahulu!", "info")
                .then((value) => {
                    window.location.href = "login.html";
                });
            }
            
        }
        async function getNameCostumer(id) {
            let scid = await getClientServiceID(),
                customer_id = await getCustomer()
            return $.post('https://build.web.id/api/customers/getCustomerdatabyId/', {
                client_id: scid.cid,
                service_id: scid.layanan_id,
                customer_id: customer_id,
            }).then(res => {
                //console.log(res)
                return res.data.firstname
            })
        }

        function getCustomer(){
            return $.post('getdata.php').then(function(customer_id){
                return customer_id
            })
        }

        function getConfigCurrency(cid, sid){
            return $.post('https://build.web.id/api/setting/getLocalSetting/', {
                client_id: cid,
                service_id: sid
            }).then(res => {
                return res.data.config_currency
            })
        }
    </script>
</body>
</html>
