<!DOCTYPE html>
<html lang="en">

<head>
    <!-- METAS -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- TITLE -->
    <title>Builder Template</title>

    <!-- FAVICON -->
    <link rel="shortcut icon" href="images/favicon.png"/>

    <!-- LOAD MAIN CSS -->
    <link href="css/style.css" rel="stylesheet" type="text/css">

    <!-- LOAD COLOR STYLE (OPTONAL) CSS -->
    <link href="css/lunar.css" rel="stylesheet" type="text/css" id="colorstyle">

    <!-- LOAD CUSTOM CSS -->
    <link href="css/custom.css" rel="stylesheet" type="text/css">

</head>

<body>
    <!-- Preloader Start -->
    <div id="preloader">
        <i class="fa fa-spinner fa-spin preloader-animation" aria-hidden="true"></i>
    </div>
    <!-- Preloader End -->
    
    
        <!-- HEADER START -->
        <!--section id="header"-->
        <!-- Fixed navbar -->
    <header>
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">
                        <img src="images/logo.png" alt="Edura - Multipurpose Website Template">
                    </a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav qw-list-item">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="profile.html">Profile</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="product.html">Product</a></li>
                        <li><a href="gallery.html">Gallery</a></li>
                        <li><a href="bonus.html">Bonus</a></li>
                        <li class="qw-list-default"><a href="default.html">Default</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" role="button" aria-haspopup="true" aria-expanded="false" data-account>Account <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                                <li><a href="sign-up.html">Sign Up</a></li>
                                <li><a href="login.html">Login</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" role="button" aria-haspopup="true" aria-expanded="false" data-login>My Account</a>
                            <ul class="dropdown-menu">
                                <li><a href="account.html">My Account</a></li>
                                <li><a href="change-pass.html">Change Password</a></li>
                                <li><a href="address-book.html">Address Book</a></li>
                                <li><a href="view-cart.html">List Cart</a></li>
                                <li><a href="whistlist.html">Whist List</a></li>
                                <li><a href="order-history.html">Order History</a></li>
                                <li><a href="rewards-points.html">Rewads Points</a></li>
                                <li><a href="transaction.html">Transaction</a></li>
                                <li><a href="logout.php">Logout</a></li>
                            </ul>
                        </li>
                        <li><a href="view-cart.html"><i class="fa fa-shopping-cart"></i> (<span count-cart>0</span>)</a></li>
                    </ul>
                </div><!--/.nav-collapse -->
            </div>
        </nav>
    </header>
        <!--/section-->
        <!-- HEADER END -->

    <!-- WRAPPER START -->
    <div id="wrapper">
        <!-- PAGE TITLE START -->
        <section id="title" class="container-fluid wow fadeInDown" style="margin-bottom: 35px">
            <div class="container">
                <div class="row">
                    <div class="col-xs-6">
                        <h1>Whist <small>List</small></h1>
                    </div>
                    <div class="col-xs-6 text-right breadcrumbs">
                        <ul class="list-inline list-unstyled">
                            <li><a href="index.html">Home</a></li>
                            <li>/</li>
                            <li>Whist List</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        <!-- PAGE TITLE END -->


        <!-- CONTENT START -->
        <section id="product" class="container" style="margin-bottom: 30px">

            <!--section id="shop" class="container"-->

                <div class="row">


                    <!-- main column start -->
                    <div class="col-md-12">

                        <div class="row">
                            
                            <div class="col-md-12 wow fadeIn" data-container>
                            <style>
                                [data-default] {
                                    display: none;
                                }
                            </style>
                            <div class="col-md-3 wow fadeInUp" style="margin-bottom: 10px;" data-item data-default>
                                <div class="text-center product-item">
                                    <div class="product-item-top">
                                        <div style="position: relative; width: 100%; height:200px; line-height: 200px; text-align: center;">
                                            <center><img alt="" class="img-responsive" src="http://placehold.it/600x500" data-image style="max-height: 200px; display: inline-block; vertical-align: middle; line-height: normal;"></center>
                                        </div>
                                        <div class="mask"></div>
                                        <ul class="list-unstyled list-inline">
                                            <!-- <li><a href="product-detail.html" data-link><i class="fa fa-link fa-fw"></i></a></li> -->
                                            <button data-add="" class="btn btn-white btn-primary"><i class="fa fa-shopping-cart ui-droppable"></i> Add To Cart</button>
                                            <button class="btn btn-danger" data-delete > DELETE</button>
                                        </ul>
                                        <template data-pid></template>
                                    <!-- </div>
                                    <div class="product-item-inner">
                                        <h3 class="product-title" data-title=""><a href="product-detail.html">Photo Camera</a></h3>
                                        <p class="product-price" data-price="">$153</p>
                                        <template data-pid></template>
                                    </div>
                                    <div class="row">
                                        <center>
                                            <button data-add="" class="btn btn-white btn-primary"><i class="fa fa-shopping-cart ui-droppable"></i> Add To Cart</button>
                                            <button class="btn btn-danger" data-delete > DELETE</button>
                                        </center> -->

                                        <h3 class="product-price" data-price></h3>
                                        <p class="product-title" data-title>$153</p>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>
                    <!-- main column end -->

                </div>
            <!--/section-->
        </section>
        <!-- CONTENT END -->

        <!-- FOOTER START -->
        <footer id="footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-3">
                        <img src="images/logo.png" alt="Logo - Web Builder Template"><br><br>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi. Nulla quis sem at nibh elementum imperdiet. Duis sagittis ipsum. Praesent mauris. <b>Lorem ipsum dolor sit amet, consectetur adipiscing</b>.</p>
                        <br>
                        <ul class="list-unstyled list-inline social-icons">
                            <li><a href="#" class="facebook"><i class="fa fa-facebook facebook"></i></a></li>
                            <li><a href="#" class="twitter"><i class="fa fa-twitter twitter"></i></a></li>
                            <li><a href="#" class="googleplus"><i class="fa fa-google-plus googleplus"></i></a></li>
                            <li><a href="#" class="youtube"><i class="fa fa-youtube youtube"></i></a></li>
                            <li><a href="#" class="linkedin"><i class="fa fa-linkedin linkedin"></i></a></li>
                        </ul>
                    </div>
                    <div class="col-md-3">
                        <h4>CONTACT US</h4>
                        <p><i class="fa fa-map-pin fa-fw"></i> Graha Pos Indonesia Lantai 6 C, Jl.Banda no.30, Bandung 40115 -  Indonesia</p>
                        <p><i class="fa fa-phone fa-fw"></i> 0804-1-808-888</p>
                        <p><i class="fa fa-phone fa-fw"></i> +62 21 52905148</p>
                        <p><i class="fa fa-envelope fa-fw"></i> info@qwords.com</p>
                    </div>
                    <div class="col-md-3">
                        <h4>PAGES</h4>
                        <ul class="list-unstyled col-md-6">
                            <li><i class="fa fa-caret-right fa-fw" aria-hidden="true"></i> <a href="#">HOME</a></li>
                            <li><i class="fa fa-caret-right fa-fw" aria-hidden="true"></i> <a href="#">PROFILE</a></li>
                            <li><i class="fa fa-caret-right fa-fw" aria-hidden="true"></i> <a href="#">CONTACT</a></li>
                            <li><i class="fa fa-caret-right fa-fw" aria-hidden="true"></i> <a href="#">PRODUCT</a></li>
                        </ul>
                        <ul class="list-unstyled col-md-6">
                            <li><i class="fa fa-caret-right fa-fw" aria-hidden="true"></i> <a href="#">GALLERY</a></li>
                            <li><i class="fa fa-caret-right fa-fw" aria-hidden="true"></i> <a href="#">BONUS</a></li>
                            <li><i class="fa fa-caret-right fa-fw" aria-hidden="true"></i> <a href="#">OTHER</a></li>
                        </ul>
                    </div>
                    <div class="col-md-3">
                        <h4>NEWSLETTER</h4>
                        <p>Subscribe to our monthly newsletter and stay updated with the latest news and info.</p>
                        <form action="#" method="post">
                            <div class="form-group">
                                <div class="input-group">
                                    <div class="input-group-addon"><i class="fa fa-envelope-o"></i></div>
                                    <input type="email" class="form-control" id="email" placeholder="Your Email Address" required>
                                </div>
                            </div>
                            <div class="form-group pull-right">
                                <button type="submit" class="btn btn-primary">Subscribe</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="row">
                    <hr>
                    <div class="col-md-12 text-center bottom">
                        <p>Copyright &copy; 2017 Web Builder. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </footer>
        <!-- FOOTER END -->


    </div>
    <!-- WRAPPER END -->

    <!-- back to top button -->
    <a id="back-to-top" href="#" class="btn btn-primary btn-lg back-to-top" role="button" title="Click to return on the top page" data-toggle="tooltip" data-placement="left"><span class="glyphicon glyphicon-chevron-up"></span></a>



    <!-- MAIN JS FILES REQUIRED ON ALL PAGES -->
    <script src="vendor/jquery/jquery.min.js"></script>

    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="vendor/bootstrap-hover-dropdown/bootstrap-hover-dropdown.js"></script>
    <script src="vendor/wow/wow.min.js"></script>
    <script src="vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
    <script src="vendor/SmoothScroll/SmoothScroll.min.js"></script>

    <script src="vendor/waypoints/waypoints.min.js"></script>
    <script src="vendor/counterup/jquery.counterup.min.js"></script>


    <!-- HERO SLIDER-->
    <script src="vendor/hero-slider/js/modernizr.js"></script>
    <script src="vendor/hero-slider/js/main.js"></script>

    <!-- OWL CAROUSEL -->
    <script src="vendor/owl-carousel/owl.carousel.js"></script>

    <!-- FILTERIZR -->
    <script src="vendor/jquery/jquery.filterizr.js"></script>

    <!-- EDURA JS REQUIRED ON ALL PAGES-->
    <script src="js/edura.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script>
        $(function () {
            loadWishList()
            getCustomerById()
        })

        function getClientServiceID() {
            return $.post('scid.txt')
            .then(res => {
                return JSON.parse(res)
            })
        }

        async function getCustomerById() {
            let scid = await getClientServiceID()
              customer_id = await getCostumerID()
            
            if(customer_id){
                $.post('https://build.web.id/api/customers/getCustomerdatabyId/', {
                  client_id: scid.cid,
                  service_id: scid.layanan_id,
                  customer_id: customer_id
                }).then(res => {
                    $('[data-login]').html(res.data.firstname+' '+res.data.lastname+' <b class="caret"></b>')
                    $('[data-account]').hide()
                })

                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                $.post("https://build.web.id/api/cart/content/",{
                    "client_id": cid,
                    "service_id": sid,
                    "customer_id": customer_id
                },function(data){
                    $('[count-cart]').text(data.count)
                });
            }else{
                $('[data-login]').hide()
                $('[data-account]').show()

                swal("Anda belum login!", "Silahkan login terlebih dahulu!", "info")
                .then((value) => {
                    window.location.href = "login.html";
                });
            }
        }

        async function getWhistlist() {
            let
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                co_id = await getCostumerID()

            return $.post('https://build.web.id/api/wishlist/data/', {

                    client_id: cid,
                    service_id: sid,
                    customer_id: co_id, // Todo Ganti nanti ya

                })

                .then(res => {
                    return res.data
                })

                .fail(res => {
                    console.log(res.responseText)
                })
        }

        async function saveCart(product_id) {
            let
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                pid = parseInt(product_id),
                customer_id = await getCostumerID()

            if(customer_id){
                $.post('https://build.web.id/api/cart/add/', {
                    client_id: cid,
                    service_id: sid,
                    customer_id: customer_id,
                    product_id: pid,
                }, function (res, status) {
                    console.log(res, status)
                    swal("Good job!", "Successfully Add To Cart!", "success")
                }).fail(res => {
                    console.log(res.responseText)
                })

                //remove product from whistlist
                removeProductCart(cid, sid, customer_id, product_id)
            }else{
                swal("Anda belum login!", "Silahkan login terlebih dahulu!", "info")
                .then((value) => {
                    window.location.href = "login.html";
                });
            }
        }

        async function loadWishList() {
            let
                wishLists = await getWhistlist(),
                scid = await getClientServiceID(),
                cid = window.atob(scid.cid),
                sid = window.atob(scid.layanan_id),
                co_id = await getCostumerID(),
                set_setting = await getConfigCurrency(scid.cid, scid.layanan_id)

            // load to html

            wishLists.forEach(wishlist => {
                let
                    clone = $('[data-default]').clone(),
                    modified_clone = clone.removeAttr("data-default")

                let
                    image = wishlist.product.image,
                    title = wishlist.product.name,
                    price = wishlist.product.price,
                    pid = wishlist.product_id

                    if(set_setting.code=='IDR'){
                        price = parseInt(price).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                    }else{
                        price = (price/set_setting.value).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                    }

                modified_clone.find('[data-image]').attr('src', image)
                modified_clone.find('[data-title]').html(title)
                //modified_clone.find('[data-price]').text(price)
                modified_clone.find('[data-price]').text(set_setting.symbol_left+' '+price)
                modified_clone.find('[data-pid]').text(pid)
                modified_clone.find('[data-add]').attr('onclick','saveCart('+wishlist.product_id+')');

                $('[data-container]').append(modified_clone)
            })

            $('[data-delete]').click(e => {
                let
                    container = $(e.target).closest('[data-item]'),
                    pid = container.find('[data-pid]').text()
  
                swal({
                    title: "Are you sure?",
                    text: "Once deleted, you will remove this product?",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                }).then((willDirect) => {
                    if (willDirect) {
                        if(co_id){
                            var req = $.post('https://build.web.id/api/wishlist/remove/', {
                                "client_id": cid,
                                "service_id": sid,
                                "customer_id": co_id, // Todo Ganti nanti ya
                                "product_id": pid,
                            }, function (res) {
                                swal("Poof! Your product has been deleted!", {
                                  icon: "success",
                                }).then((value) => {
                                    window.location.href = "whistlist.html";
                                });
                            })
                        }else{
                            swal("Anda belum login!", "Silahkan login terlebih dahulu!", "info")
                            .then((value) => {
                                window.location.href = "login.html";
                            });
                        }
                    } else {
                        swal("Your product is safe!");
                    }
                });
            })

            $('[data-update]').click(e => {

                let
                    container = $(e.target).closest('[data-item]'),
                    pid = container.find('[data-pid]').text(),
                    stock = container.find('[data-stock]').val(),
                    qty = stock



                var req = $.post('https://build.web.id/api/cart/update/', {

                    "client_id": cid,
                    "service_id": sid,
                    "customer_id": co_id, // Todo Ganti nanti ya
                    "product_id": pid,
                    "quantity": stock


                }, function (res) {
                    console.log(res)
                    alert(res.message)
                })

            })


            async function requestCart(e, action) {
                let
                    container = $(e.target).closest('[data-item]'),
                    pid = container.find('[data-pid]').text(),
                    scid = await getClientServiceID(),
                    cid = window.atob(scid.cid),
                    sid = window.atob(scid.layanan_id),
                    qty = 0,
                    co_id = await getCostumerID(),
                    msg = ""


                switch (action) {
                    case "delete":
                        qty = 0
                        msg = "Deleted"
                        break;

                    case "update":
                        let stock = container.find('[data-stock]').val()
                        qty = stock
                        msg = "Updated"
                        break;

                    default:
                        qty = 0
                        msg = "none"
                        break;
                }

                let data = {

                    "client_id": cid,
                    "service_id": sid,
                    "customer_id": co_id, // Todo Ganti nanti ya
                    "product_id": pid,
                    "quantity": qty,

                }

                // do request
                var req = $.post('https://build.web.id/api/cart/add/', data, function (res) {
                    alert("Product " + msg)
                    //location.reload()
                })
            }

        }

        function getCostumerID() {
            return $.post('getdata.php')
                .then(res => {
                    return res
                })
        }

        function getConfigCurrency(cid, sid){
            return $.post('https://build.web.id/api/setting/getLocalSetting/', {
                client_id: cid,
                service_id: sid
            }).then(res => {
                return res.data.config_currency
            })
        }

        function removeProductCart(cid, sid, customer_id, product_id){
            return $.post('https://build.web.id/api/wishlist/remove/', {
                client_id: cid,
                service_id: sid,
                customer_id: customer_id,
                product_id: product_id
            }).then(res => {
                window.location.href = "view-cart.html";
            })
        }
    </script>

</body>
</html>
